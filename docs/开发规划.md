# 开发规划文档

**文档版本**: 1.0
**最后更新**: 2025-01-28
**项目名称**: AI 驱动的动态候选人画像系统

---

## 一、项目总览

### 1.1 时间规划
- **总工期**: 3-4 周（MVP）
- **交付方式**: 分阶段交付，每个阶段可独立验收
- **发布策略**:
  - Week 2 结束: 内部 Alpha 版（阶段 0-1）
  - Week 3 结束: Beta 版（阶段 0-2）
  - Week 4 结束: 生产 MVP（阶段 0-3）

### 1.2 人力假设
- **1 名全栈开发** (开发者 + Claude Code 协作)
- **每天有效开发时间**: 4-6 小时

### 1.3 阶段概览

| 阶段 | 时长 | 重点 | 可交付 |
|-----|------|------|--------|
| 阶段 0 | 2-3天 | 基础设施 | 认证系统、部署上线 |
| 阶段 1 | 4-5天 | 🎯 AI 动态画像 | 画像演进时间线 |
| 阶段 2 | 3-4天 | 🎯 AI 面试洞察 | 面试准备页面 |
| 阶段 3 | 3-4天 | 面试流程 | 面试管理完整流程 |
| 阶段 4 | 2-3天 | 招聘决策 | 决策支持页面 |
| 阶段 5 | 2-3天 | 完善功能 | 职位管理、优化 |
| 阶段 6 | 2-3天 | 生产优化 | 安全、性能、监控 |

---

## 二、阶段 0：基础设施搭建 (2-3 天)

### 目标
建立安全可靠的基础设施，包括认证、权限、部署

### Day 1: Supabase 集成

#### 任务清单
- [ ] 创建 Supabase 项目
- [ ] 配置 PostgreSQL 数据库
- [ ] 运行数据库迁移（现有 schema）
- [ ] 配置 Supabase Auth
  - [ ] 启用 Email + Password 认证
  - [ ] 配置 JWT 密钥
  - [ ] 设置 RLS 基础策略
- [ ] 配置 Supabase Storage
  - [ ] 创建 `resumes` bucket
  - [ ] 创建 `interview-recordings` bucket
  - [ ] 设置访问策略
- [ ] 更新环境变量

#### 环境变量配置
```bash
DATABASE_URL=<supabase-connection-string>
SUPABASE_URL=<your-project-url>
SUPABASE_ANON_KEY=<your-anon-key>
SUPABASE_SERVICE_KEY=<your-service-key>
OPENROUTER_API_KEY=<your-openrouter-key>
```

### Day 2: 认证与权限系统

#### 后端认证中间件
```typescript
// server/middleware/auth.ts
export function requireAuth(req, res, next) {
  // 验证 Supabase JWT
}

export function requireRole(...roles) {
  // 验证用户角色
}
```

#### 前端认证 Context
```typescript
// client/src/contexts/auth-context.tsx
export function AuthProvider({ children }) {
  // Supabase Auth 集成
  // 提供 user, role, login, logout, signup
}
```

#### 任务清单
- [ ] 实现后端认证中间件
- [ ] 实现前端认证 Context
- [ ] 创建登录页面
- [ ] 创建注册页面（仅管理员）
- [ ] 实现 Protected Routes
- [ ] 添加角色选择
- [ ] 配置 RLS 策略

### Day 3: 部署配置

#### 任务清单
- [ ] 前端部署到 Vercel
  - [ ] 连接 GitHub repo
  - [ ] 配置环境变量
  - [ ] 设置自动部署
- [ ] 后端部署到 Vercel Serverless
  - [ ] 配置 vercel.json
  - [ ] 设置 API routes
  - [ ] 环境变量配置
- [ ] 配置自定义域名（可选）
- [ ] 设置监控和日志
  - [ ] Vercel Analytics
  - [ ] Sentry 错误追踪（可选）

### 验收标准
- ✅ 用户可以注册、登录、退出
- ✅ 三种角色权限正常工作
- ✅ 应用部署到生产环境
- ✅ 数据库连接正常

---

## 三、阶段 1：核心 AI 能力 - 动态画像 (4-5 天)

### 目标
实现 AI 驱动的动态候选人画像构建和演进

### Day 1: 数据库扩展

#### 任务清单
- [ ] 创建 `candidate_profiles` 表
- [ ] 扩展 `interviews` 表（添加转录字段）
- [ ] 创建数据库迁移脚本
- [ ] 运行迁移并验证

#### Schema 设计
```sql
CREATE TABLE candidate_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  candidate_id UUID REFERENCES candidates(id) NOT NULL,
  version INTEGER NOT NULL,
  stage TEXT NOT NULL,
  profile_data JSONB NOT NULL,
  overall_score DECIMAL(5,2),
  data_sources JSONB,
  gaps JSONB,
  strengths JSONB,
  concerns JSONB,
  ai_summary TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(candidate_id, version)
);

ALTER TABLE interviews
ADD COLUMN transcription TEXT,
ADD COLUMN recording_url TEXT,
ADD COLUMN transcription_method TEXT,
ADD COLUMN ai_key_findings JSONB,
ADD COLUMN ai_concern_areas JSONB;
```

### Day 2-3: AI 服务开发

#### 核心服务类
```typescript
// server/services/candidateProfileService.ts

export class CandidateProfileService {
  // 核心功能 1: 构建初始画像
  async buildInitialProfile(
    candidateId: string,
    resumeData: ResumeAnalysis,
    jobDescription: string
  ): Promise<CandidateProfile> {
    // 1. 构建 AI prompt
    // 2. 调用 AI 服务
    // 3. 保存画像到数据库
    // 4. 返回结果
  }

  // 核心功能 2: 更新画像（面试后）
  async updateProfileWithInterview(
    candidateId: string,
    interviewId: string
  ): Promise<CandidateProfile> {
    // 1. 获取当前最新画像
    // 2. 获取新的面试数据
    // 3. AI 分析并更新画像
    // 4. 保存新版本
    // 5. 返回结果
  }

  // 辅助功能: 获取画像演进历史
  async getProfileEvolution(
    candidateId: string
  ): Promise<CandidateProfile[]> {
    return await storage.getCandidateProfiles(candidateId);
  }
}
```

#### 任务清单
- [ ] 创建 `CandidateProfileService` 类
- [ ] 实现 `buildInitialProfile()` 方法
- [ ] 实现 `updateProfileWithInterview()` 方法
- [ ] 集成到简历上传流程
- [ ] 创建面试评价触发器
- [ ] 添加后台任务队列

### Day 4-5: 前端页面开发

#### 候选人详情页
```typescript
// client/src/pages/candidate-detail.tsx

export default function CandidateDetail() {
  return (
    <div>
      <CandidateHeader />
      <ProfileEvolutionTimeline />
      <InterviewHistory />
      <ResumeAndAttachments />
      <ActivityLog />
    </div>
  );
}
```

#### 任务清单
- [ ] 创建候选人详情页路由
- [ ] 实现画像演进时间线组件
- [ ] 实现画像卡片组件
- [ ] 添加画像对比功能
- [ ] 集成 API 端点
- [ ] 样式和响应式优化

### 验收标准
- ✅ 上传简历后自动生成初始画像
- ✅ 提交面试评价后自动更新画像
- ✅ 候选人详情页能看到完整画像演进
- ✅ 匹配度分数逐轮更新
- ✅ AI 分析结果准确且有洞察

---

## 四、阶段 2：AI 面试洞察生成 (3-4 天)

### 目标
为面试官提供 AI 驱动的面试准备材料

### Day 1: 数据库扩展

#### Schema 设计
```sql
CREATE TABLE interview_preparations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  candidate_id UUID REFERENCES candidates(id) NOT NULL,
  interview_id UUID REFERENCES interviews(id) NOT NULL,
  generated_for UUID REFERENCES users(id) NOT NULL,
  candidate_context JSONB,
  suggested_questions JSONB,
  focus_areas JSONB,
  previous_gaps JSONB,
  interviewer_tips JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 任务清单
- [ ] 创建 `interview_preparations` 表
- [ ] 运行迁移并验证

### Day 2: AI 服务开发

#### 核心方法
```typescript
// 核心功能 3: 生成面试准备材料
async generateInterviewPreparation(
  candidateId: string,
  upcomingInterviewId: string
): Promise<InterviewPreparation> {
  // 1. 获取候选人当前画像
  // 2. 获取所有历史面试
  // 3. 获取即将进行的面试信息
  // 4. AI 生成准备材料
  // 5. 保存到数据库
}
```

#### 任务清单
- [ ] 扩展 `CandidateProfileService`
- [ ] 实现 `generateInterviewPreparation()` 方法
- [ ] 集成到面试创建流程
- [ ] 添加手动刷新功能

### Day 3-4: 前端页面开发

#### 面试准备页面
```typescript
// client/src/pages/interview-prepare.tsx

export default function InterviewPreparePage() {
  return (
    <div>
      <PageHeader />
      <CandidateContextCard />
      <SuggestedQuestionsCard />
      <FocusAreasCard />
      <CoverageGapsCard />
      <InterviewerTipsCard />
    </div>
  );
}
```

#### 任务清单
- [ ] 创建面试准备页路由
- [ ] 实现候选人背景卡片
- [ ] 实现 AI 建议问题卡片（可展开）
- [ ] 实现重点考察领域卡片
- [ ] 实现面试官提示卡片
- [ ] 添加 PDF 导出功能
- [ ] 集成 API 端点

### 验收标准
- ✅ 创建面试时自动生成准备材料
- ✅ AI 建议的问题针对性强
- ✅ 重点考察领域清晰
- ✅ 面试官能轻松理解候选人状态
- ✅ 准备页面信息层次清晰

---

## 五、阶段 3：完善面试流程 (3-4 天)

### Day 1-2: 面试创建与编辑

#### 任务清单
- [ ] 创建面试表单组件
- [ ] 实现面试编辑功能
- [ ] 实现面试取消功能
- [ ] 集成到候选人详情页
- [ ] 添加时间选择器
- [ ] 添加面试官选择

### Day 2-3: 面试评价表单

#### 评价表单功能
```typescript
// client/src/components/interview-feedback-form.tsx

export function InterviewFeedbackForm() {
  return (
    <Form>
      {/* 面试记录录入（三种方式） */}
      <TranscriptionInput />

      {/* 结构化评分 */}
      <RatingFields />

      {/* 文字反馈 */}
      <TextualFeedback />

      {/* 下一步建议 */}
      <Recommendation />
    </Form>
  );
}
```

#### 任务清单
- [ ] 创建面试评价表单
- [ ] 实现三种转录方式切换
- [ ] 实现评分组件
- [ ] 实现文件上传
- [ ] 添加表单验证
- [ ] 集成 API

### Day 4: 面试详情页

#### 任务清单
- [ ] 创建面试详情页路由
- [ ] 实现多 Tab 布局
- [ ] 显示面试准备材料
- [ ] 显示面试记录
- [ ] 显示面试官评价
- [ ] 显示 AI 洞察

### 验收标准
- ✅ 可以创建、编辑、取消面试
- ✅ 面试官可以提交详细评价
- ✅ 支持三种方式记录面试
- ✅ 提交评价后自动触发画像更新
- ✅ 面试详情页展示完整信息

---

## 六、阶段 4：招聘决策支持 (2-3 天)

### Day 1: 数据库与服务

#### Schema 设计
```sql
CREATE TABLE hiring_decisions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  candidate_id UUID REFERENCES candidates(id) NOT NULL,
  job_id UUID REFERENCES jobs(id) NOT NULL,
  decision TEXT NOT NULL,
  final_score DECIMAL(5,2),
  ai_recommendation JSONB,
  interviewer_consensus JSONB,
  decision_rationale TEXT,
  decided_by UUID REFERENCES users(id),
  risk_assessment JSONB,
  onboarding_plan JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 任务清单
- [ ] 创建 `hiring_decisions` 表
- [ ] 实现决策生成服务
- [ ] 实现决策记录 API

### Day 2-3: 决策页面

#### 任务清单
- [ ] 创建招聘决策页路由
- [ ] 实现 AI 建议卡片
- [ ] 实现画像演进摘要
- [ ] 实现面试官意见汇总
- [ ] 实现优势与顾虑展示
- [ ] 实现风险评估卡片
- [ ] 实现最终决策表单
- [ ] 仅 Hiring Manager 可见

### 验收标准
- ✅ AI 能生成全面的决策建议
- ✅ 汇总所有面试官意见
- ✅ Hiring Manager 可以做出最终决策
- ✅ 决策结果正确保存
- ✅ 候选人状态相应更新

---

## 七、阶段 5：完善其他功能 (2-3 天)

### Day 1: 职位管理
- [ ] 职位创建表单
- [ ] 职位编辑功能
- [ ] 职位详情页
- [ ] 职位-候选人匹配列表

### Day 2: 搜索和筛选优化
- [ ] 候选人高级搜索
- [ ] 按技能/经验/状态筛选
- [ ] 保存搜索条件
- [ ] 批量操作

### Day 3: UI/UX 优化
- [ ] 加载状态优化
- [ ] 错误处理和提示
- [ ] 响应式设计调整
- [ ] 无障碍支持

### 验收标准
- ✅ 职位管理功能完整
- ✅ 搜索和筛选体验流畅
- ✅ 界面美观易用

---

## 八、阶段 6：生产优化与上线 (2-3 天)

### Day 1: 安全加固
- [ ] 审计所有 API 权限
- [ ] 测试 RLS 策略
- [ ] 敏感数据加密
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] CSRF 防护

### Day 2: 性能优化
- [ ] 数据库查询优化
- [ ] 添加必要的索引
- [ ] API 响应缓存
- [ ] 图片和文件压缩
- [ ] 代码分割和懒加载
- [ ] CDN 配置

### Day 3: 监控和日志
- [ ] Vercel Analytics 配置
- [ ] Sentry 错误追踪
- [ ] 关键操作审计日志
- [ ] 性能监控 Dashboard
- [ ] 告警规则设置

### 验收标准
- ✅ 安全测试通过
- ✅ 性能指标达标（P95 < 500ms）
- ✅ 监控和日志正常工作
- ✅ 生产环境稳定运行

---

## 九、风险与依赖管理

### 9.1 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| **AI 服务调用失败** | 高 | 实现重试机制、降级到基础算法 |
| **数据库迁移问题** | 高 | 本地测试、迁移前备份、回滚脚本 |
| **第三方服务依赖** | 中 | SLA 保障、准备替代方案 |
| **性能瓶颈** | 中 | 及早测试、索引优化、缓存策略 |
| **文件上传安全** | 高 | 类型验证、病毒扫描、大小限制 |

### 9.2 关键依赖

- **OpenRouter / Gemini 2.5 API**: 核心 AI 能力
  - 备选: OpenAI GPT-4

- **Supabase**: 数据库和认证
  - 备选: PostgreSQL + Auth0

- **Vercel**: 部署平台
  - 备选: Netlify, Railway

---

## 十、质量检查清单

### 每个阶段完成前必须检查:

#### 功能完整性
- [ ] 所有计划功能已实现
- [ ] 功能按预期工作
- [ ] 边界情况已处理

#### 用户体验
- [ ] 加载状态显示清晰
- [ ] 错误提示友好
- [ ] 操作响应及时
- [ ] 界面布局合理

#### 代码质量
- [ ] TypeScript 类型完整
- [ ] 代码遵循项目规范
- [ ] 无 console.log 残留
- [ ] 重要逻辑有注释

#### 安全性
- [ ] API 有权限保护
- [ ] 用户输入已验证
- [ ] 敏感信息已保护
- [ ] XSS/SQL 注入已防护

#### 性能
- [ ] API 响应时间合理
- [ ] 页面加载速度快
- [ ] 无内存泄漏
- [ ] 数据库查询优化

---

## 十一、上线前最终检查

### 功能验收
- [ ] 所有 P0 功能正常工作
- [ ] 三个角色权限正确
- [ ] AI 功能质量稳定
- [ ] 核心流程端到端测试通过

### 安全审计
- [ ] 渗透测试通过
- [ ] 敏感数据加密
- [ ] 权限控制完善
- [ ] 审计日志完整

### 性能基准
- [ ] API P95 < 500ms
- [ ] 页面 LCP < 2.5s
- [ ] AI 服务 P95 < 5s
- [ ] 数据库查询优化

### 监控告警
- [ ] 错误追踪配置
- [ ] 性能监控配置
- [ ] 关键指标告警
- [ ] 日志聚合配置

### 文档完整性
- [ ] API 文档
- [ ] 用户手册
- [ ] 运维文档
- [ ] 故障排查手册

---

## 十二、后续迭代计划（二期）

### 二期 A (1-2 周)
- [ ] 文化价值观评估框架集成
- [ ] 语音自动转录（集成 Whisper API）
- [ ] 报告和分析页面
- [ ] 候选人导入/导出

### 二期 B (2-3 周)
- [ ] 高级搜索和筛选
- [ ] 面试日程管理（日历集成）
- [ ] Email 通知自动化
- [ ] 移动端适配

### 二期 C (长期)
- [ ] 候选人推荐算法优化
- [ ] 历史数据分析和洞察
- [ ] 招聘流程模板
- [ ] 与 ATS 系统集成