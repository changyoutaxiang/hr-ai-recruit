# 快速优化手册

## 目标
在不牺牲现有功能的前提下，尽快提升本地开发体验与常规稳定性。以下改动按推荐优先级列出，可独立实施，也可一次性完成。

## 1. 统一本地启动方式
- **位置**：`package.json`、`README.md`
- **动作**
  - 更新 `package.json` 的 `dev` 脚本（或新增 `dev:full` 并在文档引用），确保通过 `concurrently` 同时拉起前后端。
  - 同步调整 `README.md` 中的启动说明，使脚本名称与实际行为一致。
- **收益**：新人上手时不会遇到“只启动后端”的困惑，减少环境排查时间。

## 2. 放宽服务端环境校验
- **位置**：`server/config/env.ts`
- **动作**
  - 为 `ensureRequiredEnv` 增加条件：当 `USE_IN_MEMORY_STORAGE=true` 或检测到测试模式时，跳过 Supabase / OpenRouter 强校验。
  - 缺少变量时输出警告日志，而非直接抛出异常。
- **收益**：支持离线或最小依赖场景，降低本地调试门槛。

## 3. 懒初始化前端 Supabase 客户端
- **位置**：`client/src/lib/supabase.ts`
- **动作**
  - 将模块级别的变量校验改为延迟执行（例如导出 `getSupabaseClient()`）。
  - 首次调用时检查环境变量，并在缺失时抛出带指引信息的错误。
- **收益**：避免构建阶段白屏，错误信息更聚焦到真实调用点。

## 4. 纠正上传格式提示
- **位置**：`server/services/supabaseStorage.ts`
- **动作**
  - 同步 `allowedTypes` 与报错文案，确保提示只包含实际允许的文件类型。
  - 若计划支持 DOC / DOCX，先放宽 `allowedTypes` 并补充 MIME 校验说明。
- **收益**：减少 QA 或用户排错成本，避免出现“文案允许但接口拒绝”的体验落差。

## 5. 建立常规健康检查流程
- **命令**：`npm run check`、`node test_user_api.js`
- **动作**
  - 将两条指令纳入提交前的最小验证步骤，可在 PR 模板或团队流程文档中注明。
  - 运行前确认 `.env` 配置完整，必要时补充执行结果到 PR 描述。
- **收益**：首次把关类型与核心 API 的回归风险，降低线上回滚概率。

---

> 建议先从第 1、2 项着手，能最快提升团队整体体验。完成后依序实施其余优化，可在 1~2 个迭代内显著改善开发流畅度。
